<link rel="import" href="../polymer/polymer-element.html">

<!-- // move to index or another html page -->
<script src="../web-animations-js/web-animations.min.js"></script>


<dom-module id="waapi-pages">
  <template>
    <style>
      :host {
        display: block;
      }
      :host > ::slotted(*) {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
      }
      :host > ::slotted(:not(.page):not(.animating)){
        display: none !important;
      }
    </style>
    <slot id="pages"></slot>
  </template>

  <script>
    /**
    * `waapi-pages`
    * Page Transitions with Web Animations API
    *
    * @customElement
    * @polymer
    * @demo demo/index.html
    */
    class WaapiPages extends Polymer.Element {
      static get is() { return 'waapi-pages'; }
      static get properties() {
        return {
        /**
        * The page we are on now
        */
        page: {
            type: String,
            observer: '_page'
        },
        /**
        * The animation request
        */
        animate: {
            type: Object,
            observer: '_load'
        },
        /**
        * True if the animate to page is loading
        */
        loading: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            notify: true
        },
        /**
        * True if the exit animation is playing
        */
        exitPlaying: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            notify: true
        },
        /**
        * True if the entry animation is playing
        */
        entryPlaying: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            notify: true
        },
        /**
        * Path to the pages
        */
        path: {
            type: String,
            value: 'src/my-',
        }

        };
      }

      _load(){
        const loadPath = `${this.path}${this.animate.to}.html`
        this.loading = true;
        Polymer.importHref(loadPath, this._loadComplete.bind(this), this._loadFailed.bind(this), false);
      }
      _loadComplete(e){
        this.loading = false;
        const animateFrom = this.$.pages.assignedNodes().find(e => e.id === this.animate.from);
        const animateTo = this.$.pages.assignedNodes().find(e => e.id === this.animate.to);
        animateFrom.classList && animateFrom.classList.add('animating')
        animateTo.classList && animateTo.classList.add('animating')
      }
      _loadFailed(err){
        console.log(err)
      }
      _page(){
        const pages = Polymer.dom(this.$.pages).getDistributedNodes();
        for (let page, i = 0; page = pages[i]; i++) {
          if(this.page == page.id){
            page.classList && page.classList.add('page');
          }  else {
            page.classList && page.classList.remove('page');
            page.classList && page.classList.remove('animating');
          }
        }
      }
      
    } window.customElements.define(WaapiPages.is, WaapiPages);
  </script>
</dom-module>
